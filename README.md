# Modelica-Drone-3D-FMI
A drone model with 3D visualization and FMU export configuration developed using Modelica by Hao Chang and Luigi Vanfretti.

![Alt text](/D_Pics/main.png "Drone Model")

# Contents
Drone Model with FMU Export Configuration

## A. Modelica Model

All sub-systems and simulation cases are contained within the 'DroneSimulation.mo' package.

How to simulate it?

1. Open ``./A_Modelica/DroneSimulation.mo``
2. The package structure is set up with three sub-packages: (1) Tools, (2) Module, (3) Tests.
3. Under the Tests package, open the model ``controlModuleTest_fmu_main.mo`` and select it as ``Simulation model``. This has inputs that act as change in x, y, z coordinates of the drone and outputs x, y, z from the pseudo-GPS modeled within.
4. Go to simulation tab of your tool and change the simulation time to 10s then click simulate button.
5. This simulation should result with the z-coordinate approaching 5 meters, and the other coordinates (x,y) should be around zero. To verify, plot the variables ``.xgps``, ``.ygps`` and ``.zgps`` of the model by running the Modelica scrip ``drone_simulation_setup.mos``. You should obtain the result below.
![Alt text](/D_Pics/sim.png "Simulation Results")

6. Within Dymola, run the script ``drone_anymation_setup.mos``, and then click on the ``Play`` button to see the animation. The red arrows indicate the force of the propellers.
![Alt text](/D_Pics/anim.gif "Animation")

## B. FMU
- It is possible to generate an FMU from the Modelica model to provide inputs to x, y and z coordinate changes.
Under the 'Test' sub-package, the ``controlModuleTest_fmu_inputs`` model can be used.

- Within ``./B_FMI/`` an FMU generated by Dymola 2019 FD01 (64-bit) with both ME and CS (using Cvode) options is included.
Note that this model requires a Modelica license to execute in your local machine to run.

## C. Running the in Simulink using FMIKIT
- Install the [FMIKit](https://github.com/CATIA-Systems/FMIKit-Simulink).

- Under the folder ``./C_SimulinkWithFMIKit`` a Simulink model ``./drone_model.slx`` set-up using FMIKit to reproduce the simulation scenario explained above.

- Note that you might need to reload the FMU using the one in the directory ``./B_FMI/`` as explained above.

- You should obtain the results shown below.
![Alt text](/D_Pics/simulinkfmikit.png "Model running in Simulink using the FMIKIT")


## Contributing
- Via pull requests.

## Copyright
(c) Hao Chang and Luigi Vanfretti, Rensselaer Polytechnic Institute, Troy, NY.

Licensed under the BSD 3-Clause License.
